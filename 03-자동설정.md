## 자동설정





#### spring boot 자동설정(1)



##### spring boot 실행 시 빈 생성은 두 단계로 작성되어 있다.

~~~java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class,args);
    }
}
~~~

- step1) spring boot를 실행할 때 @SpringBootApplication이 포함하고 있는 @ComponentScan에서 빈 대상 클래스를 검색하여 등록함.
- step2) @SpringBootApplication이 포함하고 있는 @EnableAutoConfiguration에서 빈을 등록함.



##### @ComponentScan 빈 등록

- @SpringBootApplication가 실행되는 패키지 ,해당 디렉토리의 모든 패키지 및 하위 패키지를 검색하여 빈등록 대상 클래스를 검색하여 등록.
- @Component, @Configuration, @Repository, @Service, @Controller, @RestController



##### @EnableAutoConfiguration 빈 등록(1)

~~~xml
# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\
org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\
org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\
...
~~~

- 파일위치 : org.springframework.boot:spring-boot-autoconfigure > META-INF > spring.factories
- 해당 AutoConfiguration class를 빈으로 등록함.



##### @EnableAutoConfiguration 빈 등록(2)

~~~java
@Configuration
@ConditionalOnWebApplication(
    type = Type.SERVLET
)
@ConditionalOnClass({Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class})
@ConditionalOnMissingBean({WebMvcConfigurationSupport.class})
@AutoConfigureOrder(-2147483638)
@AutoConfigureAfter({DispatcherServletAutoConfiguration.class, ValidationAutoConfiguration.class})
public class WebMvcAutoConfiguration {
...
}
~~~

- spring.factories파일 중 org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration class 내용임.

- 해당 클래스가 @Configuration 에 의해 빈이 등록되지만, 상황에 따라 스킵될 수 있다.

  - @ConditionalOn 조건이 맞지 않으면 빈 등록은 스킵된다.
  - @ConditionalOnWebApplication(type = Type.SERVLET) 의경우, 타입이 서블릿이 아니면 스킵됨.

  - ~~~java
    SpringApplication application = new SpringApplication(Application.class);
    application.setWebApplicationType(WebApplicationType.SERVLET);
    ~~~

    

